<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èˆ’å¿ƒæ—…ç¨‹è¦åŠƒ</title>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ Babel (ç”¨æ–¼è§£æ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- å¼•å…¥ Leaflet CSS (åœ°åœ–æ¨£å¼) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <!-- å¼•å…¥ Leaflet JS (åœ°åœ–æ ¸å¿ƒ) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- å®šç¾©æ¨¡çµ„è·¯å¾‘ (Import Map) -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <style>
        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #D7CCC8;
            border-radius: 20px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #A1887F;
        }
        
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* èƒŒæ™¯é»é»è£é£¾ */
        .bg-dots-pattern {
            background-image: radial-gradient(#5D4037 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Leaflet åœ°åœ–ç›¸é—œæ¨£å¼è¦†è“‹ */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(93,64,55,0.15);
        }
        .leaflet-popup-content {
            font-family: sans-serif;
            color: #5D4037;
            font-weight: bold;
        }
        
        /* è‡ªè¨‚åœ°åœ–æ¨™è¨˜å‹•ç•« */
        .custom-marker-icon {
            transition: all 0.3s ease;
        }
        .custom-marker-icon:hover {
            transform: scale(1.2);
        }
    </style>
</head>
<body class="bg-[#FDFBF7] text-[#5D4037] font-sans selection:bg-[#CFB997] selection:text-white">
    <div id="root"></div>

    <!-- ä½¿ç”¨ data-type="module" è®“ Babel è™•ç† ES Module -->
    <script type="text/babel" data-type="module">
        import React, { useState, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        
        // ç›´æ¥å¾æ¨¡çµ„å°å…¥åœ–æ¨™ï¼Œé¿å…å…¨åŸŸè®Šæ•¸å•é¡Œ
        import { 
            MapPin, Utensils, Camera, Train, Bed, Plus, Trash2, Edit3, Save, 
            Calendar, Coffee, X, Share2, ExternalLink, ShoppingBag, Music, 
            Sun, Moon, Star, Flag, Plane, Ticket, Gift, Heart, Smile, 
            Umbrella, Anchor, Bike, Zap, BookOpen, Footprints, Car, Bus, 
            Timer, Banknote, Settings, Clock, Navigation, PlayCircle,
            Map as MapIcon // é‡å‘½å Map åœ–æ¨™é¿å…è¡çª
        } from 'lucide-react';

        // --- å…¨æ–°è¨­è¨ˆï¼š24å°æ™‚åˆ¶æ™‚é–“é¸æ“‡å™¨ ---
        const CustomTimePicker = ({ value, onChange }) => {
            const [isOpen, setIsOpen] = useState(false);
            const containerRef = useRef(null);
            // å…§éƒ¨ç‹€æ…‹ï¼Œç”¨æ–¼å³æ™‚é¡¯ç¤ºé¸æ“‡çš„çµæœ
            const [internalTime, setInternalTime] = useState(value || '12:00');

            // ç•¶å¤–éƒ¨ value æ”¹è®Šæ™‚ (ä¾‹å¦‚åœ¨æ–°å¢æ¨¡å¼)ï¼ŒåŒæ­¥æ›´æ–°å…§éƒ¨ç‹€æ…‹
            useEffect(() => {
                if (value) {
                    setInternalTime(value);
                }
            }, [value]);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (containerRef.current && !containerRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            const [hour, minute] = internalTime.split(':');

            const handleHourChange = (h) => {
                const newTime = `${h}:${minute}`;
                setInternalTime(newTime); // ç«‹å³æ›´æ–°é¡¯ç¤º
                onChange(newTime);        // é€šçŸ¥çˆ¶å±¤
            };

            const handleMinuteChange = (m) => {
                const newTime = `${hour}:${m}`;
                setInternalTime(newTime); // ç«‹å³æ›´æ–°é¡¯ç¤º
                onChange(newTime);        // é€šçŸ¥çˆ¶å±¤
                setIsOpen(false);
            };

            // ç”Ÿæˆ 00-23 å°æ™‚é¸é …
            const renderHours = () => {
                const hours = Array.from({ length: 24 }, (_, i) => i.toString().padStart(2, '0'));
                
                return (
                    <div className="flex-1 border-r border-[#EFEBE0] overflow-y-auto max-h-60 custom-scrollbar p-2">
                        <div className="text-[10px] text-[#A1887F] mb-2 font-bold text-center sticky top-0 bg-white pb-1">æ™‚</div>
                        <div className="grid grid-cols-4 gap-1">
                        {hours.map((h) => (
                            <button
                            key={h}
                            onClick={() => handleHourChange(h)}
                            className={`
                                p-2 rounded text-sm font-medium transition-all duration-200
                                ${hour === h 
                                ? 'bg-[#CFB997] text-white shadow-md scale-105' 
                                : 'text-[#5D4037] hover:bg-[#F5F0E6]'}
                            `}
                            >
                            {h}
                            </button>
                        ))}
                        </div>
                    </div>
                );
            };

            // ç”Ÿæˆ 00-55 åˆ†é˜é¸é … (5åˆ†é˜é–“éš”)
            const renderMinutes = () => {
                const minutes = [];
                for (let i = 0; i < 60; i += 5) {
                    minutes.push(i.toString().padStart(2, '0'));
                }

                return (
                    <div className="w-20 overflow-y-auto max-h-60 custom-scrollbar bg-[#FAFAFA] p-2">
                        <div className="text-[10px] text-[#A1887F] mb-2 font-bold text-center sticky top-0 bg-[#FAFAFA] pb-1">åˆ†</div>
                        <div className="grid grid-cols-1 gap-1">
                        {minutes.map((m) => (
                            <button
                            key={m}
                            onClick={() => handleMinuteChange(m)}
                            className={`
                                py-2 rounded text-sm font-medium transition-colors
                                ${minute === m 
                                ? 'bg-[#D7CCC8] text-[#5D4037] font-bold shadow-inner' 
                                : 'text-[#5D4037] hover:bg-[#EFEBE0]'}
                            `}
                            >
                            {m}
                            </button>
                        ))}
                        </div>
                    </div>
                );
            };

            return (
                <div className="relative" ref={containerRef}>
                    <button
                        type="button"
                        onClick={() => setIsOpen(!isOpen)}
                        className={`
                        flex items-center gap-2 w-full border rounded-xl px-4 py-3 bg-[#FAFAFA] text-[#5D4037] font-mono text-lg outline-none transition-all duration-300
                        hover:shadow-sm
                        ${isOpen ? 'ring-2 ring-[#CFB997] border-[#CFB997]' : 'border-[#E0E0E0] hover:border-[#D7CCC8]'}
                        `}
                    >
                        <Clock size={18} className="text-[#CFB997]" />
                        <span>{internalTime}</span>
                    </button>

                    {isOpen && (
                        <div className="absolute top-full left-0 mt-2 bg-white border border-[#EFEBE0] rounded-xl shadow-xl z-50 flex w-72 overflow-hidden animate-in fade-in zoom-in duration-200 origin-top-left">
                        {renderHours()}
                        {renderMinutes()}
                        </div>
                    )}
                </div>
            );
        };

        // --- åœ°åœ–è·¯ç·šå‹•ç•« Modal (Leaflet Version) ---
        const RouteAnimationModal = ({ day, onClose }) => {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markerRef = useRef(null);
            const polylineRef = useRef(null);
            const [isPlaying, setIsPlaying] = useState(false);

            // å–å¾—æ‰€æœ‰æœ‰æ•ˆä¸”æœ‰åº§æ¨™çš„è¡Œç¨‹ (è‹¥ç„¡åº§æ¨™ï¼Œé€™é‚Šæœƒéæ¿¾æ‰æˆ–éœ€è¦æ¨¡æ“¬)
            const activities = day.activities.filter(a => a.location && a.coords);

            useEffect(() => {
                if (!mapRef.current || activities.length === 0) return;

                // 1. åˆå§‹åŒ–åœ°åœ–
                if (!mapInstanceRef.current) {
                    const map = L.map(mapRef.current).setView(activities[0].coords, 13);
                    
                    // ä½¿ç”¨ OpenStreetMap åœ–å±¤ (å…è²»ï¼Œç„¡éœ€ API Key)
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 19,
                    }).addTo(map);

                    mapInstanceRef.current = map;
                }

                const map = mapInstanceRef.current;

                // 2. æ¸…é™¤èˆŠåœ–å±¤
                map.eachLayer((layer) => {
                    if (layer instanceof L.Marker || layer instanceof L.Polyline) {
                        map.removeLayer(layer);
                    }
                });

                // 3. ç¹ªè£½è·¯å¾‘èˆ‡æ¨™è¨˜
                const latlngs = activities.map(a => a.coords);
                
                // æ·»åŠ èµ·é»èˆ‡çµ‚é»æ¨™è¨˜
                activities.forEach((act, idx) => {
                    const iconHtml = `<div style="background-color: #CFB997; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">${idx + 1}</div>`;
                    
                    const icon = L.divIcon({
                        className: 'custom-marker-icon',
                        html: iconHtml,
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    });

                    L.marker(act.coords, { icon })
                        .bindPopup(`<b>${act.time}</b><br>${act.location}`)
                        .addTo(map);
                });

                // ç¹ªè£½é€£ç·š
                const polyline = L.polyline(latlngs, { 
                    color: '#5D4037', 
                    weight: 4, 
                    opacity: 0.7, 
                    dashArray: '10, 10', // è™›ç·šæ•ˆæœ
                    lineCap: 'round'
                }).addTo(map);
                
                map.fitBounds(polyline.getBounds(), { padding: [50, 50] });
                polylineRef.current = polyline;

                // 4. åˆå§‹åŒ–ç§»å‹•æ¨™è¨˜ (å°è»Šè»Š)
                const carIcon = L.divIcon({
                    className: '',
                    html: '<div style="font-size: 24px; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));">ğŸš—</div>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });
                
                const marker = L.marker(activities[0].coords, { icon: carIcon, zIndexOffset: 1000 }).addTo(map);
                markerRef.current = marker;

                // è‡ªå‹•é–‹å§‹æ’­æ”¾
                startAnimation();

                return () => {
                    // Cleanup if needed
                };
            }, [day]); // ç•¶ day æ”¹è®Šæ™‚é‡æ–°åˆå§‹åŒ–

            const startAnimation = () => {
                if (!markerRef.current || activities.length < 2) return;
                setIsPlaying(true);

                const map = mapInstanceRef.current;
                const latlngs = activities.map(a => a.coords);
                let startTime = null;
                const duration = 5000; // å‹•ç•«ç¸½æ™‚é•· (æ¯«ç§’)

                // æ’å€¼å‡½æ•¸ï¼šè¨ˆç®—å…©é»ä¹‹é–“çš„ä½ç½®
                const interpolate = (start, end, factor) => {
                    const lat = start[0] + (end[0] - start[0]) * factor;
                    const lng = start[1] + (end[1] - start[1]) * factor;
                    return [lat, lng];
                };

                // è¨ˆç®—è·¯å¾‘ç¸½é•·åº¦ (ç°¡å–®åŠ ç¸½æ¯æ®µè·é›¢)
                let totalDist = 0;
                const distances = [];
                for(let i=0; i<latlngs.length-1; i++) {
                    const d = map.distance(latlngs[i], latlngs[i+1]);
                    distances.push(d);
                    totalDist += d;
                }

                const animate = (timestamp) => {
                    if (!startTime) startTime = timestamp;
                    const progress = (timestamp - startTime) / duration;

                    if (progress < 1) {
                        // è¨ˆç®—ç•¶å‰è·é›¢
                        const currentDist = totalDist * progress;
                        
                        // æ‰¾å‡ºç•¶å‰åœ¨å“ªä¸€æ®µ
                        let accumulatedDist = 0;
                        let segmentIndex = 0;
                        for(let i=0; i<distances.length; i++) {
                            if (accumulatedDist + distances[i] >= currentDist) {
                                segmentIndex = i;
                                break;
                            }
                            accumulatedDist += distances[i];
                        }

                        // è¨ˆç®—è©²æ®µçš„å®Œæˆæ¯”ä¾‹
                        const segmentProgress = (currentDist - accumulatedDist) / distances[segmentIndex];
                        
                        // è¨ˆç®—æ–°åº§æ¨™
                        const start = latlngs[segmentIndex];
                        const end = latlngs[segmentIndex+1];
                        const newPos = interpolate(start, end, segmentProgress);

                        markerRef.current.setLatLng(newPos);
                        
                        // é¸æ“‡æ€§ï¼šè®“åœ°åœ–è·Ÿéš¨ç§»å‹• (è‹¥æƒ³èšç„¦)
                        // map.panTo(newPos); 

                        requestAnimationFrame(animate);
                    } else {
                        markerRef.current.setLatLng(latlngs[latlngs.length-1]);
                        setIsPlaying(false);
                    }
                };

                requestAnimationFrame(animate);
            };

            return (
                <div className="fixed inset-0 bg-[#5D4037]/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-3xl shadow-2xl w-full max-w-4xl p-0 animate-in fade-in zoom-in duration-200 border border-[#EFEBE0] overflow-hidden flex flex-col h-[80vh]">
                        {/* Header */}
                        <div className="bg-[#F5F0E6] px-6 py-4 flex justify-between items-center border-b border-[#EFEBE0] flex-shrink-0">
                            <div className="flex items-center gap-2 text-[#5D4037]">
                                <PlayCircle size={20} className="text-[#CFB997]" />
                                <h3 className="text-xl font-bold">{day.date} è·¯ç·šæ¼”ç¤º</h3>
                            </div>
                            <button onClick={onClose} className="text-gray-400 hover:text-[#5D4037]">
                                <X size={20} />
                            </button>
                        </div>

                        {/* Map Container */}
                        <div className="flex-1 relative bg-[#F0EAE0]">
                            {activities.length > 0 ? (
                                <div ref={mapRef} className="w-full h-full z-0"></div>
                            ) : (
                                <div className="flex flex-col items-center justify-center h-full text-[#A1887F]">
                                    <p>é€™å¤©æ²’æœ‰è¶³å¤ çš„åœ°é»è³‡æ–™ä¾†ç”¢ç”Ÿè·¯ç·šåœ–å–”ï¼</p>
                                </div>
                            )}
                            
                            {/* Overlay Info */}
                            <div className="absolute bottom-6 left-6 z-[400] bg-white/90 backdrop-blur px-4 py-3 rounded-xl shadow-lg border border-[#EFEBE0] max-w-xs">
                                <h4 className="text-xs font-bold text-[#A1887F] uppercase mb-1">ROUTE INFO</h4>
                                <div className="text-sm font-bold text-[#5D4037]">
                                    {activities.length} å€‹åœç•™é»
                                </div>
                                <div className="text-xs text-gray-500 mt-1">
                                    èµ·é»ï¼š{activities[0]?.location}<br/>
                                    çµ‚é»ï¼š{activities[activities.length-1]?.location}
                                </div>
                            </div>
                        </div>

                        {/* Footer Controls */}
                        <div className="p-4 border-t border-[#FAFAFA] bg-white flex-shrink-0 flex justify-center">
                            <button 
                                onClick={startAnimation}
                                disabled={isPlaying || activities.length < 2}
                                className="px-8 py-3 bg-[#CFB997] text-white rounded-full font-bold hover:bg-[#BCAAA4] transition-all shadow-md flex items-center gap-2 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <PlayCircle size={18} /> 
                                {isPlaying ? 'æ¼”ç¤ºä¸­...' : 'é‡æ–°æ’­æ”¾è·¯å¾‘'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const TravelPlanner = () => {
            // --- åœ–æ¨™èˆ‡é¢¨æ ¼åº« ---
            const ICON_LIBRARY = [
                { id: 'sightseeing', icon: <Camera size={24} />, label: 'è§€å…‰', color: 'bg-[#CFB997] text-white' },
                { id: 'food', icon: <Utensils size={24} />, label: 'ç¾é£Ÿ', color: 'bg-[#E6C9A8] text-[#5D4037]' },
                { id: 'transport', icon: <Train size={24} />, label: 'äº¤é€š', color: 'bg-[#D7CCC8] text-[#5D4037]' },
                { id: 'hotel', icon: <Bed size={24} />, label: 'ä½å®¿', color: 'bg-[#DBC1AC] text-[#5D4037]' },
                { id: 'coffee', icon: <Coffee size={24} />, label: 'å’–å•¡', color: 'bg-[#C8B7A6] text-white' },
                { id: 'shopping', icon: <ShoppingBag size={24} />, label: 'è³¼ç‰©', color: 'bg-[#F2D7D5] text-[#922B21]' },
                { id: 'entertainment', icon: <Music size={24} />, label: 'å¨›æ¨‚', color: 'bg-[#D2B4DE] text-[#5B2C6F]' },
                { id: 'flight', icon: <Plane size={24} />, label: 'é£›è¡Œ', color: 'bg-[#B3E5FC] text-[#0277BD]' },
                { id: 'ticket', icon: <Ticket size={24} />, label: 'ç¥¨åˆ¸', color: 'bg-[#FFCCBC] text-[#D84315]' },
                { id: 'gift', icon: <Gift size={24} />, label: 'ç¦®ç‰©', color: 'bg-[#F8BBD0] text-[#C2185B]' },
                { id: 'date', icon: <Heart size={24} />, label: 'ç´„æœƒ', color: 'bg-[#FFCDD2] text-[#C62828]' },
                { id: 'relax', icon: <Smile size={24} />, label: 'æ”¾é¬†', color: 'bg-[#DCEDC8] text-[#33691E]' },
                { id: 'nature', icon: <Umbrella size={24} />, label: 'è‡ªç„¶', color: 'bg-[#C5E1A5] text-[#33691E]' },
                { id: 'sea', icon: <Anchor size={24} />, label: 'æµ·é‚Š', color: 'bg-[#B2EBF2] text-[#006064]' },
                { id: 'activity', icon: <Bike size={24} />, label: 'é‹å‹•', color: 'bg-[#FFECB3] text-[#FF6F00]' },
                { id: 'highlight', icon: <Zap size={24} />, label: 'é‡é»', color: 'bg-[#FFE082] text-[#FF6F00]' },
                { id: 'culture', icon: <BookOpen size={24} />, label: 'æ–‡åŒ–', color: 'bg-[#D1C4E9] text-[#4527A0]' },
                { id: 'morning', icon: <Sun size={24} />, label: 'æ—©æ™¨', color: 'bg-[#FFF9C4] text-[#FBC02D]' },
                { id: 'night', icon: <Moon size={24} />, label: 'å¤œæ™š', color: 'bg-[#37474F] text-[#ECEFF1]' },
                { id: 'custom', icon: <Star size={24} />, label: 'å…¶ä»–', color: 'bg-[#E0E0E0] text-[#616161]' },
            ];

            const TRANSPORT_OPTIONS = [
                { id: 'train', label: 'ç«è»Š/é«˜éµ', icon: <Train size={18} />, needCost: true },
                // ä¿®æ­£ï¼šä½¿ç”¨ inline JSX å–ä»£å¤–éƒ¨ SubwayIcon å…ƒä»¶
                { id: 'mrt', label: 'æ·é‹/åœ°éµ', icon: <div className="flex items-center justify-center border-2 border-current rounded" style={{width: 18, height: 18}}><span className="text-[10px] font-bold">M</span></div>, needCost: true },
                { id: 'bus', label: 'å…¬è»Š/å®¢é‹', icon: <Bus size={18} />, needCost: true },
                { id: 'taxi', label: 'è¨ˆç¨‹è»Š/Uber', icon: <Car size={18} />, needCost: true },
                { id: 'car', label: 'è‡ªè¡Œé–‹è»Š', icon: <Car size={18} />, needCost: false },
                { id: 'bike', label: 'é¨è»Š', icon: <Bike size={18} />, needCost: false },
                { id: 'walk', label: 'æ­¥è¡Œ', icon: <Footprints size={18} />, needCost: false },
                { id: 'flight', label: 'é£›æ©Ÿ', icon: <Plane size={18} />, needCost: true },
                { id: 'ship', label: 'èˆ¹é‹', icon: <Anchor size={18} />, needCost: true },
            ];

            // --- åˆå§‹æ•¸æ“š (åŠ å…¥çœŸå¯¦ç¶“ç·¯åº¦ä»¥ä¾¿åœ°åœ–æ¼”ç¤º) ---
            const initialTripData = {
                title: "å°åŒ—è¼•æ—…è¡Œ",
                destination: "å°ç£, å°åŒ—",
                startDate: "2024-05-20",
                endDate: "2024-05-22",
                days: [
                {
                    id: 1,
                    date: "05/20 Day 1",
                    label: "åŸå¸‚æ¢ç´¢",
                    activities: [
                    { 
                        id: 101, 
                        time: "10:00", 
                        type: "transport", 
                        location: "å°åŒ—ç«è»Šç«™", 
                        coords: [25.0478, 121.5170], // Lat, Lng
                        note: "æŠµé”å°åŒ—ï¼Œå‰å¾€é£¯åº—å¯„æ”¾è¡Œæ", 
                        cost: 0, 
                        transport: { type: 'mrt', duration: '15åˆ†', cost: 25 }
                    },
                    { 
                        id: 102, 
                        time: "12:00", 
                        type: "food", 
                        location: "é˜œæ­è±†æ¼¿", 
                        coords: [25.0442, 121.5248],
                        note: "å¿…åƒåšç‡’é¤…ï¼Œæ’éšŠé è¨ˆ 30 åˆ†é˜", 
                        cost: 150, 
                        transport: { type: 'walk', duration: '10åˆ†', cost: 0 } 
                    },
                    {
                        id: 103,
                        time: "14:30",
                        type: "culture",
                        location: "è¯å±±1914æ–‡å‰µåœ’å€",
                        coords: [25.0441, 121.5294],
                        note: "çœ‹å±•è¦½ã€é€›æ–‡å‰µå•†åº—",
                        cost: 300
                    }
                    ]
                },
                {
                    id: 2,
                    date: "05/21 Day 2",
                    label: "æ­·å²èˆ‡å¤•é™½",
                    activities: [
                    { id: 201, time: "09:30", type: "ticket", location: "åœ‹ç«‹æ•…å®®åšç‰©é™¢", coords: [25.1024, 121.5486], note: "åƒè§€ç¿ ç‰ç™½èœï¼Œé è¨ˆåœç•™ 3 å°æ™‚", cost: 350 },
                    { id: 202, time: "16:00", type: "sea", location: "æ·¡æ°´è€è¡—", coords: [25.1695, 121.4437], note: "æ­æ·é‹è‡³æ·¡æ°´ï¼Œçœ‹å¤•é™½ã€åƒé˜¿çµ¦", cost: 0 },
                    ]
                },
                {
                    id: 3,
                    date: "05/22 Day 3",
                    label: "æº–å‚™è¿”å®¶",
                    activities: []
                }
                ]
            };

            // --- State ---
            const [trip, setTrip] = useState(initialTripData);
            const [activeDayId, setActiveDayId] = useState(1);
            const [isEditing, setIsEditing] = useState(false);
            const [editingActivity, setEditingActivity] = useState(null);
            const [editingDayTitle, setEditingDayTitle] = useState(false);
            const [tempDayTitle, setTempDayTitle] = useState("");
            
            // Modals
            const [showAddModal, setShowAddModal] = useState(false);
            const [showTransportModal, setShowTransportModal] = useState(false);
            const [showSettingsModal, setShowSettingsModal] = useState(false);
            const [showMapModal, setShowMapModal] = useState(false); 
            const [showRouteAnimModal, setShowRouteAnimModal] = useState(false); // æ–°å¢ï¼šè·¯ç·šå‹•ç•« Modal ç‹€æ…‹
            
            // Forms
            const [newActivityForm, setNewActivityForm] = useState({ 
                time: "12:00", 
                type: "sightseeing", 
                location: "", 
                note: "",
                cost: "" 
            });
            
            const [transportForm, setTransportForm] = useState({
                dayId: null,
                activityId: null,
                type: 'train',
                duration: '',
                cost: ''
            });

            const [settingsForm, setSettingsForm] = useState({
                title: "",
                destination: "",
                startDate: "",
                endDate: ""
            });

            const [sidebarWidth, setSidebarWidth] = useState(320);
            const [isResizing, setIsResizing] = useState(false);
            const sidebarRef = useRef(null);

            // --- Helper Functions ---
            const getGoogleMapLink = (location) => {
                return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`;
            };

            const getIconData = (type) => {
                return ICON_LIBRARY.find(item => item.id === type) || ICON_LIBRARY[ICON_LIBRARY.length - 1];
            };

            const getTransportOption = (type) => {
                return TRANSPORT_OPTIONS.find(t => t.id === type) || TRANSPORT_OPTIONS[0];
            };

            const formatDateRange = (start, end) => {
                if (!start) return "æœªè¨­å®šæ—¥æœŸ";
                return `${start.replace(/-/g, '/')} - ${end ? end.replace(/-/g, '/') : '?'}`;
            };

            const formatDateMMDD = (dateObj) => {
                return `${(dateObj.getMonth() + 1).toString().padStart(2, '0')}/${dateObj.getDate().toString().padStart(2, '0')}`;
            };

            // --- Resizing Logic ---
            const startResizing = (e) => {
                e.preventDefault();
                setIsResizing(true);
            };

            const stopResizing = () => {
                setIsResizing(false);
            };

            const resize = (e) => {
                if (isResizing) {
                const newWidth = Math.max(250, Math.min(600, e.clientX));
                setSidebarWidth(newWidth);
                }
            };

            useEffect(() => {
                window.addEventListener('mousemove', resize);
                window.addEventListener('mouseup', stopResizing);
                return () => {
                window.removeEventListener('mousemove', resize);
                window.removeEventListener('mouseup', stopResizing);
                };
            }, [isResizing]);

            // --- CRUD Operations ---
            
            const deleteDay = (dayId) => {
                if (trip.days.length === 0) return;
                if (!window.confirm("ç¢ºå®šè¦åˆªé™¤é€™æ•´å¤©çš„è¡Œç¨‹å—ï¼Ÿ(åŒ…å«æ‰€æœ‰æ´»å‹•ï¼Œåˆªé™¤å¾Œç„¡æ³•å¾©åŸ)")) return;

                const newDays = trip.days.filter(d => d.id !== dayId);
                
                const reindexedDays = newDays.map((day, index) => {
                    const datePart = day.date.split(' ')[0];
                    return {
                    ...day,
                    date: `${datePart} Day ${index + 1}`
                    };
                });

                setTrip(prev => ({ ...prev, days: reindexedDays }));
                
                if (reindexedDays.length === 0) {
                    setActiveDayId(null);
                } else {
                    setActiveDayId(reindexedDays[0].id);
                }
            };

            const saveDayTitle = () => {
                const updatedDays = trip.days.map(d => 
                    d.id === activeDayId ? { ...d, label: tempDayTitle } : d
                );
                setTrip({ ...trip, days: updatedDays });
                setEditingDayTitle(false);
            };

            const deleteActivity = (dayId, actId) => {
                const updatedDays = trip.days.map(day => {
                if (day.id === dayId) {
                    return { ...day, activities: day.activities.filter(a => a.id !== actId) };
                }
                return day;
                });
                setTrip({ ...trip, days: updatedDays });
            };

            const saveActivityEdit = (dayId, actId, newData) => {
                const updatedDays = trip.days.map(day => {
                if (day.id === dayId) {
                    return {
                    ...day,
                    activities: day.activities.map(act => act.id === actId ? { ...act, ...newData } : act)
                    };
                }
                return day;
                });
                setTrip({ ...trip, days: updatedDays });
                setEditingActivity(null);
            };

            const saveTransport = () => {
                const { dayId, activityId, type, duration, cost } = transportForm;
                const transportData = { type, duration, cost };
                
                const option = getTransportOption(type);
                if (!option.needCost) {
                    transportData.cost = 0;
                }

                const updatedDays = trip.days.map(day => {
                if (day.id === dayId) {
                    return {
                    ...day,
                    activities: day.activities.map(act => act.id === activityId ? { ...act, transport: transportData } : act)
                    };
                }
                return day;
                });

                setTrip({ ...trip, days: updatedDays });
                setShowTransportModal(false);
            };

            const openTransportModal = (dayId, activityId, currentTransport) => {
                setTransportForm({
                    dayId,
                    activityId,
                    type: currentTransport?.type || 'train',
                    duration: currentTransport?.duration || '',
                    cost: currentTransport?.cost || ''
                });
                setShowTransportModal(true);
            };

            const openSettingsModal = () => {
                setSettingsForm({
                    title: trip.title,
                    destination: trip.destination,
                    startDate: trip.startDate,
                    endDate: trip.endDate
                });
                setShowSettingsModal(true);
            };

            const saveSettings = () => {
                const { title, destination, startDate, endDate } = settingsForm;
                
                let newDays = [...trip.days];

                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    const diffTime = Math.abs(end - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; 

                    if (!isNaN(diffDays) && diffDays > 0) {
                        const generatedDays = [];
                        for (let i = 0; i < diffDays; i++) {
                            const currentDate = new Date(start);
                            currentDate.setDate(start.getDate() + i);
                            const dateStr = formatDateMMDD(currentDate); 
                            const displayDate = `${dateStr} Day ${i + 1}`;

                            const existingDay = trip.days[i];
                            
                            if (existingDay) {
                                generatedDays.push({
                                    ...existingDay,
                                    date: displayDate, 
                                });
                            } else {
                                generatedDays.push({
                                    id: Date.now() + i, 
                                    date: displayDate,
                                    label: "è‡ªç”±æ´»å‹•",
                                    activities: []
                                });
                            }
                        }
                        newDays = generatedDays;
                    }
                }

                setTrip({
                    ...trip,
                    title,
                    destination,
                    startDate,
                    endDate,
                    days: newDays
                });
                
                if(newDays.length > 0) {
                    if (!newDays.find(d => d.id === activeDayId)) {
                        setActiveDayId(newDays[0].id);
                    }
                } else {
                    setActiveDayId(null);
                }

                setShowSettingsModal(false);
            };

            // æ–°å¢æ´»å‹•æ™‚ï¼Œå› ç‚ºæ²’æœ‰ API Key å¯ä»¥åæŸ¥åº§æ¨™ï¼Œæˆ‘å€‘æ¨¡æ“¬ä¸€å€‹åº§æ¨™
            // é‚è¼¯ï¼šå–è©²å¤©æœ€å¾Œä¸€å€‹é»çš„åº§æ¨™ï¼Œç¨å¾®åç§»ä¸€é»é»ï¼Œè®“è·¯ç·šèƒ½ç¹¼çºŒç•«ä¸‹å»
            const handleAddActivity = () => {
                if (!newActivityForm.location) return;
                
                // æ‰¾æœ€å¾Œä¸€å€‹å·²çŸ¥åº§æ¨™
                const currentActivities = trip.days.find(d => d.id === activeDayId)?.activities || [];
                const lastActivity = currentActivities.length > 0 ? currentActivities[currentActivities.length - 1] : null;
                
                // é è¨­åº§æ¨™ (å°åŒ—è»Šç«™)
                let newCoords = [25.0478, 121.5170]; 
                
                if (lastActivity && lastActivity.coords) {
                    // åœ¨æœ€å¾Œä¸€å€‹é»é™„è¿‘éš¨æ©Ÿåç§» 0.01~0.03 åº¦ (ç´„ 1~3 å…¬é‡Œ)
                    const latOffset = (Math.random() - 0.5) * 0.05;
                    const lngOffset = (Math.random() - 0.5) * 0.05;
                    newCoords = [lastActivity.coords[0] + latOffset, lastActivity.coords[1] + lngOffset];
                }

                const newAct = {
                    id: Date.now(),
                    ...newActivityForm,
                    coords: newCoords, // æ¨¡æ“¬åº§æ¨™
                    completed: false
                };

                const updatedDays = trip.days.map(day => {
                if (day.id === activeDayId) {
                    const newActivities = [...day.activities, newAct].sort((a, b) => a.time.localeCompare(b.time));
                    return { ...day, activities: newActivities };
                }
                return day;
                });

                setTrip({ ...trip, days: updatedDays });
                setShowAddModal(false);
                setNewActivityForm({ 
                    time: "12:00", 
                    type: "sightseeing", 
                    location: "", 
                    note: "",
                    cost: ""
                });
            };

            const handleAddDay = () => {
                const newDayId = Date.now();
                const dayCount = trip.days.length + 1;
                let dateStr = "";
                if (trip.startDate) {
                    const start = new Date(trip.startDate);
                    if (!isNaN(start)) {
                        const nextDate = new Date(start);
                        nextDate.setDate(start.getDate() + dayCount - 1);
                        dateStr = formatDateMMDD(nextDate);
                    }
                }
                
                const newDay = {
                id: newDayId,
                date: `${dateStr} Day ${dayCount}`,
                label: "æ–°çš„ä¸€å¤©",
                activities: []
                };
                setTrip({ ...trip, days: [...trip.days, newDay] });
                setActiveDayId(newDayId);
            };

            const generateMapRouteLink = () => {
                const allLocations = trip.days.flatMap(day => day.activities.map(act => act.location)).filter(loc => loc && loc.trim() !== "");
                if (allLocations.length === 0) return "https://www.google.com/maps";
                const path = allLocations.map(loc => encodeURIComponent(loc)).join('/');
                return `https://www.google.com/maps/dir/${path}`;
            };

            const activeDayData = trip.days.find(d => d.id === activeDayId);

            return (
                <div className="flex h-screen bg-[#FDFBF7] text-[#5D4037] font-sans selection:bg-[#CFB997] selection:text-white overflow-hidden">
                
                {/* --- Sidebar --- */}
                <aside 
                    ref={sidebarRef}
                    style={{ width: sidebarWidth }}
                    className="flex-shrink-0 bg-[#F5F0E6] flex flex-col border-r border-[#EFEBE0] shadow-[4px_0_24px_rgba(93,64,55,0.03)] z-20 relative transition-width duration-75 ease-linear"
                >
                    {/* æ—…è¡Œè³‡è¨Š */}
                    <div className="p-8 pb-4 animate-in fade-in slide-in-from-left-4 duration-700 group">
                    <div className="flex items-center gap-2 mb-2 opacity-60 text-xs tracking-widest uppercase font-bold text-[#8D6E63]">
                        <MapPin size={12} />
                        {trip.destination}
                    </div>
                    <h1 className="text-3xl font-bold text-[#5D4037] mb-4 leading-tight">{trip.title}</h1>
                    
                    {/* æ—¥æœŸèˆ‡è¨­å®šæŒ‰éˆ• */}
                    <div className="flex items-center gap-2">
                        <div className="flex items-center gap-2 text-sm text-[#8D6E63] bg-[#EFEBE0] py-2 px-3 rounded-lg inline-flex">
                            <Calendar size={14} />
                            <span>{formatDateRange(trip.startDate, trip.endDate)}</span>
                        </div>
                        <button 
                            onClick={openSettingsModal}
                            className="p-2 bg-white rounded-lg shadow-sm text-[#CFB997] hover:bg-[#CFB997] hover:text-white transition-all hover:rotate-90 duration-300"
                            title="æ—…ç¨‹è¨­å®š"
                        >
                            <Settings size={16} />
                        </button>
                        
                        {/* åœ°åœ–æŒ‰éˆ• */}
                        <button 
                            onClick={() => setShowMapModal(true)}
                            className="p-2 bg-white rounded-lg shadow-sm text-[#CFB997] hover:bg-[#CFB997] hover:text-white transition-all hover:scale-110 duration-300"
                            title="æª¢è¦–è·¯ç·šåœ°åœ–"
                        >
                            <MapIcon size={16} />
                        </button>
                    </div>
                    </div>

                    {/* å¤©æ•¸å°èˆª */}
                    <nav className="flex-1 overflow-y-auto px-6 py-4 space-y-3 scrollbar-hide">
                    <div className="flex justify-between items-center mb-2 px-2">
                        <div className="text-xs font-bold text-[#A1887F] uppercase tracking-wider">Itinerary</div>
                    </div>
                    
                    {trip.days.map((day, idx) => (
                        <div 
                        key={day.id}
                        className="relative group/item animate-in fade-in slide-in-from-left-8 duration-500 fill-mode-backwards"
                        style={{ animationDelay: `${idx * 100}ms` }}
                        >
                            <button
                            onClick={() => setActiveDayId(day.id)}
                            className={`
                                w-full text-left px-5 py-4 rounded-xl transition-all duration-300 relative overflow-hidden group/btn
                                ${activeDayId === day.id 
                                ? 'bg-white shadow-md border border-[#EFEBE0] translate-x-2' 
                                : 'hover:bg-[#EFEBE0] hover:translate-x-1 border border-transparent'}
                            `}
                            >
                            <div className="flex items-center justify-between relative z-10">
                                <div>
                                <div className={`text-xs font-bold mb-1 transition-colors ${activeDayId === day.id ? 'text-[#CFB997]' : 'text-[#A1887F]'}`}>
                                    {day.date}
                                </div>
                                <div className="font-bold text-lg text-[#5D4037] truncate w-32">{day.label}</div>
                                </div>
                                {activeDayId === day.id && <div className="h-2 w-2 rounded-full bg-[#CFB997] animate-pulse" />}
                            </div>
                            </button>
                        </div>
                    ))}

                    {trip.days.length === 0 && (
                        <div className="text-center py-8 text-[#A1887F] text-sm italic">
                            è¡Œç¨‹è¡¨æ˜¯ç©ºçš„...
                        </div>
                    )}
                    
                    <button 
                        onClick={handleAddDay}
                        className="w-full py-3 mt-4 border-2 border-dashed border-[#D7CCC8] rounded-xl text-[#A1887F] hover:border-[#CFB997] hover:text-[#CFB997] hover:bg-white/50 transition-all active:scale-95 flex items-center justify-center gap-2 text-sm font-bold"
                    >
                        <Plus size={16} /> æ–°å¢å¤©æ•¸
                    </button>
                    </nav>

                    {/* åº•éƒ¨åŠŸèƒ½ */}
                    <div className="p-6 border-t border-[#E0D8CE] bg-[#F0EAE0]">
                        <div className="flex gap-3">
                            <button className="flex-1 py-3 bg-[#CFB997] text-white rounded-lg hover:bg-[#BCAAA4] transition-all hover:-translate-y-0.5 font-bold shadow-sm flex items-center justify-center gap-2 active:scale-95">
                                <Share2 size={18} /> åˆ†äº«
                            </button>
                            <button 
                                onClick={() => setIsEditing(!isEditing)}
                                className={`px-4 rounded-lg border border-[#D7CCC8] transition-colors flex items-center justify-center active:scale-95 ${isEditing ? 'bg-[#5D4037] text-white' : 'bg-white text-[#5D4037] hover:bg-[#FAF9F6]'}`}
                                title="ç·¨è¼¯æ¨¡å¼"
                            >
                                <Edit3 size={18} />
                            </button>
                        </div>
                    </div>
                </aside>

                {/* --- Resizer --- */}
                <div
                    className="w-4 bg-[#FDFBF7] hover:bg-[#EFEBE0] cursor-col-resize flex items-center justify-center z-30 transition-colors group relative -ml-2"
                    onMouseDown={startResizing}
                >
                    <div className="w-[1px] h-8 bg-[#D7CCC8] group-hover:bg-[#8D6E63]"></div>
                    <div className="absolute top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-[#5D4037] text-white text-[10px] px-1 py-0.5 rounded pointer-events-none whitespace-nowrap shadow-sm">
                        æ‹–æ›³èª¿æ•´
                    </div>
                </div>

                {/* --- Main Content --- */}
                <main className="flex-1 overflow-y-auto relative bg-dots-pattern">
                    {/* ç§»é™¤ bg-dots-pattern é¡åˆ¥ï¼Œåªä¿ç•™èƒŒæ™¯è‰² */}
                    {/* é€™è£¡çš„ div æ§åˆ¶èƒŒæ™¯é»é»é€æ˜åº¦ï¼Œé™ä½ç‚º 0.02 */}
                    <div className="absolute inset-0 opacity-[0.02] pointer-events-none" style={{ backgroundImage: 'radial-gradient(#5D4037 1px, transparent 1px)', backgroundSize: '24px 24px' }}></div>

                    <div 
                        key={activeDayId} 
                        className="max-w-4xl mx-auto px-12 py-16 animate-in fade-in slide-in-from-bottom-8 duration-500 ease-out"
                    >
                    
                    {trip.days.length === 0 || !activeDayData ? (
                        <div className="flex flex-col items-center justify-center min-h-[60vh] animate-in zoom-in duration-500">
                            <div className="p-8 rounded-full bg-[#F5F0E6] mb-6 animate-pulse">
                                <Calendar size={48} className="text-[#8D6E63]" />
                            </div>
                            <h2 className="text-3xl font-bold text-[#5D4037] mb-4">é‡æ–°é–‹å§‹è¦åŠƒ</h2>
                            <p className="text-[#8D6E63] mb-8">ç›®å‰çš„è¡Œç¨‹è¡¨ç©ºç©ºå¦‚ä¹Ÿï¼Œæ–°å¢ç¬¬ä¸€å¤©ä¾†é–‹å§‹å§ï¼</p>
                            <button 
                                onClick={handleAddDay}
                                className="px-8 py-4 bg-[#CFB997] text-white rounded-full shadow-lg hover:bg-[#BCAAA4] transition-all hover:scale-105 active:scale-95 font-bold text-lg flex items-center gap-2"
                            >
                                <Plus size={24} /> å»ºç«‹ç¬¬ä¸€å¤©è¡Œç¨‹
                            </button>
                        </div>
                    ) : (
                        <>
                            <div className="mb-12 flex items-end justify-between border-b border-[#EFEBE0] pb-6">
                                <div className="flex-1">
                                    <span className="text-[#CFB997] font-bold text-lg block mb-1 animate-in fade-in duration-700">{activeDayData?.date}</span>
                                    
                                    {editingDayTitle ? (
                                        <div className="flex items-center gap-2">
                                            <input 
                                                type="text" 
                                                autoFocus
                                                value={tempDayTitle}
                                                onChange={(e) => setTempDayTitle(e.target.value)}
                                                className="text-4xl font-bold text-[#5D4037] bg-transparent border-b-2 border-[#CFB997] focus:outline-none w-full max-w-md"
                                                onKeyDown={(e) => e.key === 'Enter' && saveDayTitle()}
                                            />
                                            <button onClick={saveDayTitle} className="p-2 bg-[#CFB997] text-white rounded-full hover:bg-[#BCAAA4] animate-in zoom-in">
                                                <Save size={20} />
                                            </button>
                                        </div>
                                    ) : (
                                        <h2 
                                            className="text-4xl font-bold text-[#5D4037] cursor-pointer hover:text-[#8D6E63] group flex items-center gap-3 transition-colors duration-300"
                                            onClick={() => {
                                                setTempDayTitle(activeDayData?.label);
                                                setEditingDayTitle(true);
                                            }}
                                            title="é»æ“Šä¿®æ”¹æ¨™é¡Œ"
                                        >
                                            {activeDayData?.label}
                                            <Edit3 size={24} className="opacity-0 group-hover:opacity-30 transition-opacity text-[#CFB997] duration-300" />
                                        </h2>
                                    )}
                                </div>

                                <div className="flex flex-col items-end gap-2">
                                    <div className="flex gap-2">
                                        {/* æ–°å¢ï¼šæ’­æ”¾è·¯ç·šå‹•ç•«æŒ‰éˆ• */}
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                setShowRouteAnimModal(true);
                                            }}
                                            className="flex items-center gap-1 text-[#CFB997] hover:text-white hover:bg-[#CFB997] px-3 py-1.5 rounded-lg transition-colors text-sm border border-[#CFB997] active:scale-95"
                                            title="æ’­æ”¾ç•¶å¤©è¡Œç¨‹è·¯ç·šå‹•ç•«"
                                        >
                                            <PlayCircle size={16} /> æ’­æ”¾è·¯ç·š
                                        </button>

                                        <button 
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                deleteDay(activeDayData.id);
                                            }}
                                            className="flex items-center gap-1 text-red-300 hover:text-red-500 hover:bg-red-50 px-3 py-1.5 rounded-lg transition-colors text-sm border border-transparent hover:border-red-100 active:scale-95"
                                        >
                                            <Trash2 size={16} /> åˆªé™¤é€™ä¸€å¤©
                                        </button>
                                    </div>
                                    <div className="text-[#A1887F] text-sm">
                                        {activeDayData?.activities.length} å€‹è¡Œç¨‹
                                    </div>
                                </div>
                            </div>

                            {activeDayData.activities.length === 0 ? (
                                <div className="flex flex-col items-center justify-center py-32 border-2 border-dashed border-[#EFEBE0] rounded-3xl bg-white/50 animate-in fade-in zoom-in duration-500">
                                <Coffee size={64} className="mb-6 text-[#D7CCC8]" />
                                <p className="text-xl text-[#8D6E63] font-medium mb-2">é€™ä¸€å¤©é‚„æ˜¯ä¸€å¼µç™½ç´™</p>
                                <p className="text-[#A1887F] mb-8">é»æ“Šæ¨™é¡Œå¯ä»¥ä¿®æ”¹é€™å¤©çš„åç¨±å–”ï¼</p>
                                <button 
                                    onClick={() => setShowAddModal(true)}
                                    className="px-8 py-3 bg-[#CFB997] text-white rounded-full shadow-lg hover:bg-[#BCAAA4] hover:shadow-xl hover:-translate-y-1 transition-all flex items-center gap-2 font-bold active:scale-95"
                                >
                                    <Plus size={20} /> æ–°å¢ç¬¬ä¸€å€‹è¡Œç¨‹
                                </button>
                                </div>
                            ) : (
                                <div className="space-y-0 relative pl-4 pb-20">

                                    {activeDayData.activities.map((activity, index) => {
                                        const iconData = getIconData(activity.type);
                                        const nextActivity = activeDayData.activities[index + 1];
                                        const hasTransport = !!activity.transport;
                                        const transportInfo = activity.transport ? getTransportOption(activity.transport.type) : null;
                                        const hasCost = activity.cost && Number(activity.cost) > 0;
                                        
                                        return (
                                            <div 
                                                key={activity.id} 
                                                className="relative animate-in slide-in-from-bottom-4 duration-700 fill-mode-backwards"
                                                style={{ animationDelay: `${index * 150}ms` }}
                                            >
                                                <div className="flex gap-8 group relative z-10">
                                                    <div className="flex flex-col items-center min-w-[60px] pt-2 relative">
                                                        <div className={`
                                                            w-14 h-14 rounded-2xl rotate-3 flex items-center justify-center shadow-md border-[3px] border-[#FDFBF7] transition-all duration-300 group-hover:rotate-0 group-hover:scale-110 group-hover:shadow-lg
                                                            ${iconData.color}
                                                        `}>
                                                            {iconData.icon}
                                                        </div>
                                                        <span className="mt-2 text-sm font-bold text-[#8D6E63] font-mono bg-[#FDFBF7] px-2 py-0.5 rounded-md border border-[#EFEBE0] shadow-sm">
                                                            {activity.time}
                                                        </span>
                                                    </div>

                                                    <div className="flex-1 bg-white p-6 rounded-2xl shadow-[0_4px_20px_rgba(93,64,55,0.05)] border border-[#EFEBE0] group-hover:border-[#CFB997]/50 group-hover:shadow-[0_8px_30px_rgba(93,64,55,0.08)] transition-all duration-300 relative overflow-hidden mb-8 transform hover:-translate-y-1 hover:shadow-lg">
                                                        <div className="absolute top-0 left-0 w-1 h-full bg-[#EFEBE0] group-hover:bg-[#CFB997] transition-colors duration-300"></div>

                                                        {editingActivity === activity.id ? (
                                                            <div className="pl-4 space-y-4">
                                                                <div className="flex gap-4">
                                                                    <div className="w-1/3">
                                                                    <CustomTimePicker 
                                                                        value={activity.time} 
                                                                        onChange={(val) => {
                                                                            const input = document.getElementById(`edit-time-${activity.id}`);
                                                                            if(input) input.value = val;
                                                                        }} 
                                                                    />
                                                                    <input type="hidden" defaultValue={activity.time} id={`edit-time-${activity.id}`} />
                                                                    </div>
                                                                    <input type="text" defaultValue={activity.location} id={`edit-loc-${activity.id}`} className="flex-1 bg-[#FAFAFA] border border-[#E0E0E0] rounded-xl p-3 font-bold text-[#5D4037]" />
                                                                </div>
                                                                
                                                                <div>
                                                                    <label className="text-xs text-[#A1887F] mb-1 block">é–€ç¥¨/è²»ç”¨ (0ç‚ºå…è²»)</label>
                                                                    <div className="relative">
                                                                        <Banknote size={14} className="absolute left-3 top-2.5 text-[#CFB997]" />
                                                                        <input 
                                                                            type="number" 
                                                                            defaultValue={activity.cost} 
                                                                            id={`edit-cost-${activity.id}`} 
                                                                            placeholder="0"
                                                                            className="w-full bg-[#FAFAFA] border border-[#E0E0E0] rounded p-2 pl-9 text-sm" 
                                                                        />
                                                                    </div>
                                                                </div>

                                                                <textarea defaultValue={activity.note} id={`edit-note-${activity.id}`} className="w-full bg-[#FAFAFA] border border-[#E0E0E0] rounded p-2 text-sm resize-none h-20" />
                                                                <div className="flex justify-end gap-2 pt-2">
                                                                    <button onClick={() => setEditingActivity(null)} className="px-3 py-1 text-sm text-gray-400 hover:text-gray-600">å–æ¶ˆ</button>
                                                                    <button 
                                                                        onClick={() => {
                                                                            const timeInput = document.getElementById(`edit-time-${activity.id}`);
                                                                            const time = timeInput.value; 
                                                                            const location = document.getElementById(`edit-loc-${activity.id}`).value;
                                                                            const note = document.getElementById(`edit-note-${activity.id}`).value;
                                                                            const cost = document.getElementById(`edit-cost-${activity.id}`).value;
                                                                            saveActivityEdit(activeDayId, activity.id, { time, location, note, cost });
                                                                        }}
                                                                        className="px-4 py-1 text-sm bg-[#CFB997] text-white rounded hover:bg-[#BCAAA4]"
                                                                    >
                                                                        <Save size={14} /> å„²å­˜
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <div className="pl-4 flex justify-between items-start gap-6">
                                                                <div className="flex-1">
                                                                    <div className="flex items-center gap-2 mb-2">
                                                                        <span className="text-[10px] uppercase tracking-wider font-bold text-[#A1887F] bg-[#F5F0E6] px-2 py-0.5 rounded transition-colors group-hover:bg-[#EFEBE0]">
                                                                            {iconData.label}
                                                                        </span>
                                                                        {hasCost ? (
                                                                            <span className="text-[10px] font-bold text-[#5D4037] bg-[#FFF3E0] px-2 py-0.5 rounded border border-[#FFE0B2] flex items-center gap-1">
                                                                                <Banknote size={10} /> ${activity.cost}
                                                                            </span>
                                                                        ) : (
                                                                            <span className="text-[10px] font-bold text-[#689F38] bg-[#F1F8E9] px-2 py-0.5 rounded border border-[#DCEDC8]">
                                                                                å…è²» / å…ç¥¨
                                                                            </span>
                                                                        )}
                                                                    </div>
                                                                    <h3 className="text-2xl font-bold text-[#5D4037] mb-2">{activity.location}</h3>
                                                                    <p className="text-[#8D6E63] leading-relaxed whitespace-pre-line">{activity.note}</p>
                                                                    
                                                                    <div className="mt-4 pt-4 border-t border-[#FAFAFA] flex items-center">
                                                                        <a 
                                                                            href={getGoogleMapLink(activity.location)}
                                                                            target="_blank"
                                                                            rel="noopener noreferrer"
                                                                            className="inline-flex items-center gap-2 text-sm font-medium text-[#CFB997] hover:text-[#8D6E63] transition-colors group/link bg-[#FAFAFA] hover:bg-[#F5F0E6] px-3 py-1.5 rounded-lg"
                                                                        >
                                                                            <MapIcon size={16} />
                                                                            <span>åœ¨ Google Maps ä¸ŠæŸ¥çœ‹ {activity.location}</span>
                                                                            <ExternalLink size={12} className="opacity-50 group-hover/link:opacity-100 transition-opacity" />
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div className={`flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300 ${isEditing ? 'opacity-100' : ''}`}>
                                                                    <button onClick={() => setEditingActivity(activity.id)} className="p-2 text-gray-400 hover:text-[#CFB997] hover:bg-[#F5F0E6] rounded-lg transition-colors active:scale-95"><Edit3 size={18} /></button>
                                                                    <button onClick={() => deleteActivity(activeDayId, activity.id)} className="p-2 text-gray-400 hover:text-red-400 hover:bg-red-50 rounded-lg transition-colors active:scale-95"><Trash2 size={18} /></button>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>

                                                {nextActivity && (
                                                    <div className="absolute left-[29px] top-[70px] bottom-[-20px] w-0.5 bg-[#E0D8CE] flex flex-col items-center justify-center z-0">
                                                        <button 
                                                            onClick={() => openTransportModal(activeDayId, activity.id, activity.transport)}
                                                            className={`
                                                                relative z-10 my-auto flex items-center gap-2 px-3 py-1.5 rounded-full border shadow-sm transition-all hover:scale-110 active:scale-95
                                                                ${hasTransport 
                                                                    ? 'bg-white border-[#D7CCC8] text-[#5D4037]' 
                                                                    : 'bg-[#FDFBF7] border-[#EFEBE0] text-[#D7CCC8] hover:border-[#CFB997] hover:text-[#CFB997]'}
                                                            `}
                                                            title="è¨­å®šäº¤é€šæ–¹å¼"
                                                        >
                                                            {hasTransport ? (
                                                                <>
                                                                    <div className="text-[#8D6E63]">{transportInfo?.icon}</div>
                                                                    <span className="text-xs font-bold text-[#8D6E63]">{activity.transport.duration}</span>
                                                                    {(transportInfo.needCost && activity.transport.cost > 0) && (
                                                                        <span className="text-xs text-[#A1887F] bg-[#F5F0E6] px-1.5 rounded ml-1">
                                                                            ${activity.transport.cost}
                                                                        </span>
                                                                    )}
                                                                </>
                                                            ) : (
                                                                <>
                                                                    <Plus size={12} />
                                                                    <Footprints size={12} className="rotate-90 opacity-60" />
                                                                </>
                                                            )}
                                                        </button>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                
                                    <div className="flex justify-center pt-8 relative z-10">
                                        <button
                                            onClick={() => setShowAddModal(true)}
                                            className="flex items-center gap-2 px-8 py-3 bg-white border border-[#CFB997] text-[#CFB997] rounded-full shadow-sm hover:bg-[#CFB997] hover:text-white transition-all hover:scale-105 active:scale-95 font-bold group"
                                        >
                                            <Plus size={18} className="group-hover:rotate-90 transition-transform" /> åŠ å…¥ä¸‹ä¸€å€‹è¡Œç¨‹
                                        </button>
                                    </div>
                                </div>
                            )}
                        </>
                    )}
                    </div>
                </main>

                {/* --- Map Route Modal --- */}
                {showMapModal && (
                    <div className="fixed inset-0 bg-[#5D4037]/30 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl w-full max-w-lg p-0 animate-in fade-in zoom-in duration-200 border border-[#EFEBE0] overflow-hidden">
                            <div className="bg-[#F5F0E6] px-6 py-4 flex justify-between items-center border-b border-[#EFEBE0]">
                                <div className="flex items-center gap-2 text-[#5D4037]">
                                    <MapIcon size={20} />
                                    <h3 className="text-xl font-bold">è·¯ç·šé è¦½</h3>
                                </div>
                                <button onClick={() => setShowMapModal(false)} className="text-gray-400 hover:text-[#5D4037]">
                                    <X size={20} />
                                </button>
                            </div>
                            
                            <div className="p-6">
                                <p className="text-sm text-[#8D6E63] mb-4 leading-relaxed">
                                    ç³»çµ±å°‡è‡ªå‹•å½™æ•´æ‚¨é€™è¶Ÿæ—…ç¨‹ä¸­æ‰€æœ‰çš„æ™¯é»èˆ‡æ´»å‹•ï¼Œä¸¦ç”Ÿæˆä¸€æ¢æœ€ä½³åŒ–çš„è·¯ç·šåœ–ã€‚
                                </p>
                                
                                <div className="bg-[#FAFAFA] rounded-xl p-4 border border-[#E0E0E0] max-h-48 overflow-y-auto custom-scrollbar mb-6">
                                    <h4 className="text-xs font-bold text-[#A1887F] mb-2 uppercase">é€”ç¶“åœ°é»æ¸…å–®</h4>
                                    <div className="space-y-2">
                                        {trip.days.flatMap(day => day.activities).length > 0 ? (
                                            trip.days.flatMap(day => day.activities.map(act => act.location)).filter(l => l).map((loc, idx) => (
                                                <div key={idx} className="flex items-center gap-2 text-sm text-[#5D4037]">
                                                    <div className="w-1.5 h-1.5 rounded-full bg-[#CFB997]"></div>
                                                    {loc}
                                                </div>
                                            ))
                                        ) : (
                                            <div className="text-sm text-gray-400 italic">ç›®å‰é‚„æ²’æœ‰ä»»ä½•è¡Œç¨‹åœ°é»...</div>
                                        )}
                                    </div>
                                </div>

                                <a 
                                    href={generateMapRouteLink()} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    className="w-full bg-[#4285F4] text-white py-3 rounded-xl font-bold hover:bg-[#3367D6] transition-all shadow-md flex items-center justify-center gap-2 active:scale-95"
                                >
                                    <Navigation size={18} />
                                    åœ¨ Google Maps ä¸Šé–‹å•Ÿå®Œæ•´è·¯ç·š
                                </a>
                            </div>
                        </div>
                    </div>
                )}

                {/* --- Route Animation Modal --- */}
                {showRouteAnimModal && activeDayData && (
                    <RouteAnimationModal 
                        day={activeDayData} 
                        onClose={() => setShowRouteAnimModal(false)}
                    />
                )}

                {/* --- Add Activity Modal --- */}
                {showAddModal && (
                    <div className="fixed inset-0 bg-[#5D4037]/30 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-3xl shadow-2xl w-full max-w-2xl p-0 animate-in fade-in zoom-in duration-300 border border-[#EFEBE0] overflow-hidden flex flex-col max-h-[90vh]">
                        
                        <div className="px-8 py-6 border-b border-[#FAFAFA] flex justify-between items-center bg-white sticky top-0 z-10">
                        <h3 className="text-2xl font-bold text-[#5D4037]">æ–°å¢è¡Œç¨‹</h3>
                        <button onClick={() => setShowAddModal(false)} className="text-gray-400 hover:text-gray-600 transition-colors bg-[#FAFAFA] p-2 rounded-full hover:bg-[#F5F0E6]">
                            <X size={20} />
                        </button>
                        </div>
                        
                        <div className="p-8 overflow-y-auto custom-scrollbar">
                            <div className="space-y-6">
                                <div>
                                    <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">æ™‚é–“</label>
                                    {/* ä½¿ç”¨å…¨æ–°çš„æ™‚é–“é¸æ“‡å™¨ */}
                                    <CustomTimePicker 
                                        value={newActivityForm.time} 
                                        onChange={(val) => setNewActivityForm({...newActivityForm, time: val})} 
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">é¸æ“‡ä¸€å¼µè²¼ç´™ (ä»£è¡¨è¡Œç¨‹é¡å‹)</label>
                                    <div className="grid grid-cols-4 sm:grid-cols-6 gap-3 max-h-56 overflow-y-auto p-1">
                                        {ICON_LIBRARY.map((item) => (
                                            <button key={item.id} onClick={() => setNewActivityForm({...newActivityForm, type: item.id})} className={`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all duration-200 gap-2 aspect-square active:scale-95 ${newActivityForm.type === item.id ? 'bg-[#F5F0E6] border-[#CFB997] ring-4 ring-[#CFB997]/20 scale-105 shadow-md' : 'bg-white border-[#EFEBE0] hover:border-[#D7CCC8] hover:bg-[#FAFAFA] opacity-70 hover:opacity-100'}`}>
                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center ${item.color}`}>{item.icon}</div>
                                                <span className="text-[10px] font-bold text-[#8D6E63]">{item.label}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">åœ°é» / è¡Œç¨‹åç¨±</label>
                                    <div className="relative">
                                        <input type="text" placeholder="ä¾‹å¦‚: å°åŒ—ç«è»Šç«™" value={newActivityForm.location} onChange={(e) => setNewActivityForm({...newActivityForm, location: e.target.value})} className="w-full border border-[#E0E0E0] rounded-xl px-4 py-4 pl-12 bg-[#FAFAFA] focus:ring-2 focus:ring-[#CFB997] outline-none font-bold text-[#5D4037] text-lg placeholder:font-normal placeholder:text-gray-400" />
                                        <MapPin size={20} className="absolute left-4 top-4.5 text-[#CFB997]" />
                                    </div>
                                </div>
                                
                                {/* æ–°å¢è²»ç”¨æ¬„ä½ */}
                                <div>
                                    <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">é–€ç¥¨ / è²»ç”¨ (é¸å¡«)</label>
                                    <div className="relative">
                                        <input 
                                            type="number" 
                                            placeholder="0 (è‹¥ä¸éœ€é–€ç¥¨å‰‡å…å¡«)" 
                                            value={newActivityForm.cost} 
                                            onChange={(e) => setNewActivityForm({...newActivityForm, cost: e.target.value})} 
                                            className="w-full border border-[#E0E0E0] rounded-xl px-4 py-3 pl-12 bg-[#FAFAFA] focus:ring-2 focus:ring-[#CFB997] outline-none text-[#5D4037]" 
                                        />
                                        <Banknote size={20} className="absolute left-4 top-3.5 text-[#CFB997]" />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">å‚™è¨»</label>
                                    <textarea placeholder="ä¾‹å¦‚: åŒ—è»Šå¤§å»³é›†åˆï¼Œè¨˜å¾—è²·å°éµä¾¿ç•¶..." rows="2" value={newActivityForm.note} onChange={(e) => setNewActivityForm({...newActivityForm, note: e.target.value})} className="w-full border border-[#E0E0E0] rounded-xl px-4 py-3 bg-[#FAFAFA] focus:ring-2 focus:ring-[#CFB997] outline-none resize-none text-sm" />
                                </div>
                            </div>
                        </div>

                        <div className="p-6 border-t border-[#FAFAFA] bg-white sticky bottom-0 z-10">
                            <button onClick={handleAddActivity} className="w-full bg-[#CFB997] text-white py-4 rounded-xl font-bold hover:bg-[#BCAAA4] transition-all shadow-md hover:shadow-lg flex justify-center items-center gap-2 text-lg active:scale-95">
                                <Plus size={24} /> åŠ å…¥è¡Œç¨‹
                            </button>
                        </div>
                    </div>
                    </div>
                )}

                {/* --- Transport Edit Modal --- */}
                {showTransportModal && (
                    <div className="fixed inset-0 bg-[#5D4037]/30 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 animate-in fade-in zoom-in duration-200">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-bold text-[#5D4037]">é»åˆ°é»äº¤é€š</h3>
                            <button onClick={() => setShowTransportModal(false)} className="text-gray-400 hover:text-gray-600"><X size={20} /></button>
                        </div>

                        <div className="space-y-4">
                            <div className="grid grid-cols-3 gap-2">
                                {TRANSPORT_OPTIONS.map(opt => (
                                    <button
                                        key={opt.id}
                                        onClick={() => setTransportForm({...transportForm, type: opt.id})}
                                        className={`
                                            flex flex-col items-center justify-center p-2 rounded-xl border text-xs gap-1 transition-all active:scale-95
                                            ${transportForm.type === opt.id 
                                                ? 'bg-[#5D4037] text-white border-[#5D4037]' 
                                                : 'bg-white text-[#8D6E63] border-[#EFEBE0] hover:bg-[#F5F0E6]'}
                                        `}
                                    >
                                        {opt.icon}
                                        {opt.label}
                                    </button>
                                ))}
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs font-bold text-[#8D6E63] mb-1 flex items-center gap-1">
                                        <Timer size={12} /> é ä¼°æ™‚é–“
                                    </label>
                                    <input 
                                        type="text" 
                                        placeholder="å¦‚: 30åˆ†"
                                        value={transportForm.duration}
                                        onChange={(e) => setTransportForm({...transportForm, duration: e.target.value})}
                                        className="w-full border border-[#E0E0E0] rounded-lg p-2 bg-[#FAFAFA] focus:outline-none focus:border-[#CFB997]"
                                    />
                                </div>
                                
                                <div>
                                    <label className={`text-xs font-bold text-[#8D6E63] mb-1 flex items-center gap-1 ${!getTransportOption(transportForm.type).needCost && 'opacity-30'}`}>
                                        <Banknote size={12} /> ç¥¨åƒ¹/è»Šè³‡
                                    </label>
                                    <input 
                                        type="number" 
                                        placeholder="0"
                                        value={transportForm.cost}
                                        onChange={(e) => setTransportForm({...transportForm, cost: e.target.value})}
                                        disabled={!getTransportOption(transportForm.type).needCost}
                                        className={`w-full border border-[#E0E0E0] rounded-lg p-2 bg-[#FAFAFA] focus:outline-none focus:border-[#CFB997] ${!getTransportOption(transportForm.type).needCost && 'bg-gray-100 cursor-not-allowed opacity-50'}`}
                                    />
                                </div>
                            </div>
                            
                            {!getTransportOption(transportForm.type).needCost && (
                                <p className="text-xs text-[#A1887F] text-center bg-[#F5F0E6] py-1 rounded">
                                    * é¸æ“‡ {getTransportOption(transportForm.type).label}ï¼Œç³»çµ±å°‡è‡ªå‹•å¿½ç•¥è²»ç”¨
                                </p>
                            )}

                            <button 
                                onClick={saveTransport}
                                className="w-full bg-[#CFB997] text-white py-2.5 rounded-xl font-bold hover:bg-[#BCAAA4] mt-2 active:scale-95 transition-transform"
                            >
                                å„²å­˜è¨­å®š
                            </button>
                        </div>
                    </div>
                    </div>
                )}

                {/* --- Settings Modal --- */}
                {showSettingsModal && (
                    <div className="fixed inset-0 bg-[#5D4037]/30 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 animate-in fade-in zoom-in duration-200 border border-[#EFEBE0]">
                            <div className="flex justify-between items-center mb-6 border-b border-[#FAFAFA] pb-4">
                                <h3 className="text-xl font-bold text-[#5D4037]">æ—…ç¨‹è¨­å®š</h3>
                                <button onClick={() => setShowSettingsModal(false)} className="text-gray-400 hover:text-gray-600 transition-colors bg-[#FAFAFA] p-2 rounded-full hover:bg-[#F5F0E6]">
                                    <X size={20} />
                                </button>
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">æ—…ç¨‹æ¨™é¡Œ</label>
                                    <input 
                                        type="text" 
                                        value={settingsForm.title}
                                        onChange={(e) => setSettingsForm({...settingsForm, title: e.target.value})}
                                        className="w-full border border-[#E0E0E0] rounded-xl px-4 py-3 bg-[#FAFAFA] focus:ring-2 focus:ring-[#CFB997] outline-none text-[#5D4037] font-bold"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">ç›®çš„åœ°</label>
                                    <input 
                                        type="text" 
                                        value={settingsForm.destination}
                                        onChange={(e) => setSettingsForm({...settingsForm, destination: e.target.value})}
                                        className="w-full border border-[#E0E0E0] rounded-xl px-4 py-3 bg-[#FAFAFA] focus:ring-2 focus:ring-[#CFB997] outline-none text-[#5D4037]"
                                    />
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">å‡ºç™¼æ—¥æœŸ</label>
                                        <input 
                                            type="date" 
                                            value={settingsForm.startDate}
                                            onChange={(e) => setSettingsForm({...settingsForm, startDate: e.target.value})}
                                            className="w-full border border-[#E0E0E0] rounded-xl px-4 py-3 bg-[#FAFAFA] focus:ring-2 focus:ring-[#CFB997] outline-none text-[#5D4037]"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-[#8D6E63] uppercase tracking-wide mb-2">è¿”å®¶æ—¥æœŸ</label>
                                        <input 
                                            type="date" 
                                            value={settingsForm.endDate}
                                            onChange={(e) => setSettingsForm({...settingsForm, endDate: e.target.value})}
                                            className="w-full border border-[#E0E0E0] rounded-xl px-4 py-3 bg-[#FAFAFA] focus:ring-2 focus:ring-[#CFB997] outline-none text-[#5D4037]"
                                        />
                                    </div>
                                </div>
                                
                                <div className="bg-[#FFF8E1] p-3 rounded-lg text-xs text-[#8D6E63] leading-relaxed">
                                    <span className="font-bold block mb-1">ğŸ’¡ å°æç¤ºï¼š</span>
                                    ä¿®æ”¹æ—¥æœŸå¾Œï¼Œç³»çµ±æœƒè‡ªå‹•å¹«æ‚¨å¢æ¸›å¤©æ•¸ï¼Œä¸¦é‡æ–°è¨ˆç®—æ¯å¤©çš„æ—¥æœŸæ¨™ç±¤å–”ï¼
                                </div>

                                <button 
                                    onClick={saveSettings}
                                    className="w-full bg-[#CFB997] text-white py-3 rounded-xl font-bold hover:bg-[#BCAAA4] transition-all shadow-md mt-4 active:scale-95"
                                >
                                    å„²å­˜ä¸¦æ›´æ–°è¡Œç¨‹è¡¨
                                </button>
                            </div>
                        </div>
                    </div>
                )}

                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<TravelPlanner />);
    </script>
</body>
</html>
